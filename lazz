import os
import subprocess
from keyauth import api
import sys
import time
import os
import hashlib
from time import sleep
from datetime import datetime
import subprocess
import ctypes
import os

banner = f"""
______________                  
__  ____/__  /________   ______ 
_  /    __  /_  __ \_ | / /  _ \+
/ /___  _  / / /_/ /_ |/ //  __/
\____/  /_/  \____/_____/ \___/                     
"""

def clear():
    subprocess.run('cls' if os.name == 'nt' else 'clear', shell=True)

clear()
print("Initializing")
clear()
print(banner)

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

if is_admin():
    pass
else:
    print("Note! You did't run the file with adminstrator. Exiting...")
    os.system("pause")
    sys.exit()

def getchecksum():
    md5_hash = hashlib.md5()
    file = open(''.join(sys.argv), "rb")
    md5_hash.update(file.read())
    digest = md5_hash.hexdigest()
    return digest


keyauthapp = api(
    name = "spoofer", # Application Name
    ownerid = "XGfOcCHOm8", # Owner ID
    secret = "e63fa9d7e9bd304bee7664935d16d9d7080ab5ba51efeea9826eb4f2395a00ca", # Application Secret
    version = "1.0", # Application Version
    hash_to_check = getchecksum()
)

def answer():
    clear()
    print(banner)
    try:
        print('1.Login \n2.Register')
        ans = input("Select Option: ")
        if ans == "1":
            user = input('Provide username: ')
            password = input('Provide password: ')
            keyauthapp.login(user, password)
            time.sleep(2)
        elif ans == "2":
            user = input('Provide username: ')
            password = input('Provide password: ')
            license = input('Provide License: ')
            keyauthapp.register(user, password, license)
        else:
            print("\nInvalid option")
            sleep(1)
            clear()
            answer()
    except KeyboardInterrupt:
        os._exit(1)


answer()


def choice():
    time.sleep(2)
    clear()
    print(banner)
    check()
    user_input = input("Do you want to [E]nable or [D]isable Vanguard?[E/D]? ")
    if user_input.upper() == "E":
        enable()
    elif user_input.upper() == "D":
        disable()
    else:
        choice()

def check():
    print()
    print("Status of vanguard (vgc and vgk):")
    subprocess.run(["sc", "query", "vgc"])
    subprocess.run(["sc", "query", "vgk"])
    print()

def enable():
    subprocess.run(["sc", "config", "vgk", "start=", "system"])
    subprocess.run(["sc", "config", "vgc", "start=", "demand"])
    choice2()

def disable():
    subprocess.run(["sc", "config", "vgc", "start=", "disabled"])
    subprocess.run(["sc", "config", "vgk", "start=", "disabled"])
    subprocess.run(["net", "stop", "vgc"])
    subprocess.run(["net", "stop", "vgk"])
    subprocess.run(["taskkill", "/IM", "vgtray.exe"])
    input("Press Enter to exit...")
    exit()

def choice2():
    user_input = input("Do you want to restart?(required to save changed)[Y/N]? ")
    if user_input.upper() == "Y":
        restart()
    elif user_input.upper() == "N":
        exit()
    else:
        choice2()

def restart():
    print("restarting in 5 seconds")
    print("5")
    os.system("ping -n 2 127.0.0.1 > nul")
    print("4")
    os.system("ping -n 2 127.0.0.1 > nul")
    print("3")
    os.system("ping -n 2 127.0.0.1 > nul")
    print("2")
    os.system("ping -n 2 127.0.0.1 > nul")
    print("1")
    os.system("ping -n 2 127.0.0.1 > nul")
    subprocess.run(["shutdown.exe", "/r", "/t", "00"])

choice()

